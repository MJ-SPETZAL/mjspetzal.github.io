<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HANGED MAN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Share+Tech+Mono&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* SVGã®æç”»ã‚¹ã‚¿ã‚¤ãƒ« */
        .hangman-part {
            fill: none;
            stroke: #2c3e50;
            stroke-width: 4;
            stroke-linecap: round;
        }
        /* QWERTYé…åˆ—ã®ãŸã‚ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’è§£é™¤ã—ã€flexãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ */
        #keyboard {
            display: flex;
            flex-direction: column;
            gap: 4px; /* gap-1 md:gap-2 ã«ç›¸å½“ */
            padding: 12px;
            background-color: #f9fafb; /* bg-gray-50 */
            border-radius: 8px; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); /* shadow-md */
        }
        .key-row {
            display: flex;
            justify-content: center;
            gap: 4px; /* gap-1 md:gap-2 ã«ç›¸å½“ */
        }
        .key-button {
            flex-grow: 1;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.15s;
        }
        @media (min-width: 768px) {
            .key-button {
                padding: 12px 16px;
                font-size: 16px;
            }
        }
        /* ã‚³ãƒ³ãƒ†ãƒŠã®èƒŒæ™¯ã« subtle gradient ã‚’é©ç”¨ */
        #game-container {
            background: linear-gradient(145deg, #ffffff, #f0f4f8);
        }
        /* ãƒãƒ³ã‚°ãƒãƒ³æç”»ã‚¨ãƒªã‚¢ã«å½±ã‚’ä»˜ã‘ã¦ç«‹ä½“æ„Ÿã‚’å‡ºã™ */
        #hangman-svg-container {
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
             border-radius: 12px;
             background-color: #fff;
             padding: 8px;
        }

        /* --- ã“ã“ã‹ã‚‰è¿½åŠ ï¼šARGæ¼”å‡ºç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #arg-curtain {
            position: fixed; top: 0; left: 0; width: 100%; height: 0;
            background-color: black; transition: height 1.5s ease-in-out;
            z-index: 9998; pointer-events: none;
        }
        #arg-curtain.active { height: 100vh; pointer-events: all; }
        #arg-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background-color: black; color: #00FF00; display: none; z-index: 9999;
            flex-direction: column; justify-content: center; align-items: center;
            font-family: 'Share Tech Mono', monospace; padding: 20px;
        }
        #login-form { display: none; margin-top: 20px; border-top: 1px solid #060; padding-top: 20px; width: 100%; max-width: 400px; }
        #login-input { background: transparent; border: none; color: #0f0; outline: none; font-size: 1.5rem; width: 100%; font-family: inherit; }
        .cursor { display: inline-block; width: 10px; height: 1.2em; background: #0f0; animation: blink 1s infinite; vertical-align: middle; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-xl shadow-2xl rounded-xl p-6 md:p-8 space-y-6">
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 text-center border-b-4 border-indigo-500 pb-3">
            HANGED MAN
        </h1>

        <div class="space-y-3 p-3 bg-gray-50 rounded-lg shadow-inner">
            <div class="flex flex-wrap gap-2 justify-center" id="mode-selection-buttons">
                </div>
            <p class="text-center text-sm font-medium text-gray-700">ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰: <span id="current-mode-display" class="font-bold text-indigo-600"></span></p>
        </div>

        <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-6">
            
            <div id="hangman-svg-container" class="flex-shrink-0 w-full md:w-1/2 flex justify-center items-center">
                <svg id="hangman-svg" viewBox="0 0 100 120" class="w-40 h-48 md:w-48 md:h-60">
                    <line id="part-gallows-base" x1="10" y1="110" x2="90" y2="110" class="hangman-part hidden" /> 
                    <line id="part-gallows-pole" x1="20" y1="110" x2="20" y2="10" class="hangman-part hidden" /> 
                    <line id="part-gallows-beam" x1="20" y1="10" x2="70" y2="10" class="hangman-part hidden" />
                    <line id="part-gallows-rope" x1="70" y1="10" x2="70" y2="20" class="hangman-part hidden" />
                    <circle id="part-head" cx="70" cy="30" r="10" class="hangman-part hidden" />
                    <line id="part-body" x1="70" y1="40" x2="70" y2="80" class="hangman-part hidden" />
                    <line id="part-larm" x1="70" y1="50" x2="60" y2="65" class="hangman-part hidden" />
                    <line id="part-rarm" x1="70" y1="50" x2="80" y2="65" class="hangman-part hidden" />
                    <line id="part-lleg" x1="70" y1="80" x2="60" y2="95" class="hangman-part hidden" />
                    <line id="part-rleg" x1="70" y1="80" x2="80" y2="95" class="hangman-part hidden" />
                </svg>
            </div>

            <div class="w-full md:w-1/2 space-y-4">
                <div id="word-display" class="text-4xl md:text-5xl font-mono tracking-widest text-center text-indigo-700 p-4 bg-indigo-50 rounded-lg shadow-inner border-2 border-indigo-200 whitespace-nowrap hover:shadow-lg transition duration-200"></div>
                <div class="flex justify-between text-lg text-gray-600 font-semibold">
                    <p>é€£å‹: <span id="current-streak-display" class="font-bold text-yellow-600">0</span></p>
                    <p id="timer-display-container" class="hidden">æ™‚é–“: <span id="timer-display" class="font-bold text-red-600">0.00</span>s</p>
                    <p>é–“é•ã„æ®‹ã‚Š: <span id="remaining-guesses" class="font-bold text-red-500">8</span></p>
                </div>
                <div class="bg-gray-100 p-3 rounded-lg shadow-inner">
                    <h3 class="font-semibold text-gray-700 mb-1">ä½¿ã£ãŸæ–‡å­—:</h3>
                    <div id="guessed-letters-list" class="text-xl font-mono break-words min-h-[1.5rem]"></div>
                </div>
            </div>
        </div>

        <div id="keyboard"></div>
        
        <div class="text-center">
            <button id="restart-button" class="px-6 py-3 bg-green-500 text-white font-bold rounded-full shadow-lg hover:bg-green-600 transition duration-150 transform hover:scale-105 disabled:bg-gray-400" disabled>
                æ–°ã—ã„ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹
            </button>
        </div>
    </div>

    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm text-center transform transition-transform duration-300 scale-95 opacity-0" id="message-box">
            <h2 id="message-title" class="text-3xl font-bold mb-3 text-indigo-600"></h2>
            <p id="message-text" class="text-lg text-gray-700 mb-4"></p>
            <button id="modal-close-button" class="px-5 py-2 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition duration-150">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <div id="rules-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg transform transition-transform duration-300 scale-95 opacity-0" id="rules-box">
            <h2 class="text-3xl font-bold mb-4 text-indigo-700 text-center">ğŸ’¡ ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ« ğŸ’¡</h2>
            <div class="space-y-4 text-gray-700">
                <p>ãƒãƒ³ã‚°ãƒãƒ³ï¼ˆHanged Manï¼‰ã¯ã€éš ã•ã‚ŒãŸå˜èªã‚’æ¨æ¸¬ã™ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã‚’ä¸€ã¤ãšã¤é¸ã‚“ã§ã€å˜èªã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹æ¨æ¸¬ã—ã¾ã™ã€‚</p>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li>å˜èªã«å«ã¾ã‚Œã‚‹æ–‡å­—ã‚’æ¨æ¸¬ã™ã‚‹ã¨ã€ãã®æ–‡å­—ãŒå˜èªå†…ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
                    <li>æ¨æ¸¬ã—ãŸæ–‡å­—ãŒå˜èªã«å«ã¾ã‚Œã¦ã„ãªã„å ´åˆã€<b>çµé¦–å°ã®ãƒ‘ãƒ¼ãƒ„ãŒä¸€ã¤è¿½åŠ </b>ã•ã‚Œã¾ã™ã€‚</li>
                    <li>ãƒ‘ãƒ¼ãƒ„ã¯8ã¤ã¾ã§æç”»ã•ã‚Œã¾ã™ã€‚<b>åˆè¨ˆ8å›</b>ã®é–“é•ã„ã¾ã§ã«å˜èªã‚’ã™ã¹ã¦å½“ã¦ã‚Œã°<b>å‹åˆ©</b>ã§ã™ï¼</li>
                </ul>
            </div>
            <button id="rules-close-button" class="mt-6 w-full px-5 py-2 bg-indigo-500 text-white font-semibold rounded-lg hover:bg-indigo-600 transition duration-150">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <div id="arg-curtain"></div>
    <div id="arg-screen">
        <div id="glitch-area" class="text-left max-w-lg text-lg leading-relaxed"></div>
        <div id="login-form">
            <p class="mb-2 text-xs">AUTHORIZED ACCESS ONLY</p>
            <div class="flex items-center border-b border-green-900 pb-2">
                <span class="mr-2">></span>
                <input type="password" id="login-input" autocomplete="off" placeholder="PASSWORD">
                <span class="cursor"></span>
            </div>
            <p id="auth-status" class="mt-4 text-xs text-red-500"></p>
            <div id="success-content" class="hidden mt-6 p-4 border border-green-500 bg-green-900/20">
                <p class="text-xl font-bold mb-2">ACCESS GRANTED.</p>
                <p class="text-sm">æ¬¡ã®ç›®çš„åœ°ï¼šhttps://(ç§˜å¯†ã®URLã‚’å…¥åŠ›)</p>
            </div>
        </div>
    </div>

    <script>
        // --- ç´”ä¹Ÿã•ã‚“ã®å˜èªãƒªã‚¹ãƒˆ ---
        const words = ["APPLE", "ORANGE", "GRAPE", "LEMON", "PEACH", "PLUM", "CHERRY", "MANGO", "PAPAYA", "LITCHI", "APRICOT", "RAISIN", "OLIVE", "BERRY", "MELON", "PUMPKIN", "CABBAGE", "ONION", "CARROT", "RADISH", "TOMATO", "POTATO", "GARLIC", "BROCCOLI", "SPINACH", "CORN", "SUGAR", "FLOUR", "SAUCE", "PIZZA", "BURGER", "BACON", "STEAK", "CHICKEN", "SUSHI", "PASTA", "COFFEE", "TEA", "JUICE", "CREAM", "CHEESE", "BREAD", "WINE", "BEER", "VODKA", "WHISKY", "GINGER", "CHILI", "CLOVES", "PEPPER", "SALMON", "TUNA", "SHRIMP", "SQUID", "MUTTON", "NOODLE", "WAFFLE", "TOAST", "BISCUIT", "COOKIE", "CANDY", "SODA", "WATER", "YOGURT", "HONEY", "SYRUP", "MUSHROOM", "TIGER", "LION", "ZEBRA", "BEAR", "SHARK", "WOLF", "SNAKE", "MOUSE", "EAGLE", "FROG", "CAT", "DOG", "HORSE", "DEER", "SHEEP", "GOAT", "PANDA", "KOALA", "MONKEY", "GIRAFFE", "ELEPHANT", "RHINO", "HIPPO", "SEAL", "WALRUS", "KANGAROO", "PARROT", "OWL", "CROW", "DOVE", "SWAN", "DUCK", "CHICK", "FOX", "RACCOON", "SQUIRREL", "RABBIT", "BADGER", "OTTER", "WEASEL", "FERRET", "LIZARD", "TURTLE", "CRAB", "LOBSTER", "BEE", "WASP", "ANT", "BUG", "MOTH", "FLY", "WORM", "SLOTH", "COUGAR", "FALCON", "VULTURE", "HERON", "EMU", "KIWI", "ALBATROSS", "PENGUIN", "DOLPHIN", "WHALE", "OCTOPUS", "JELLY", "STARFISH", "EEL", "CRICKET", "TERRIER", "RIVER", "MOUNT", "BEACH", "FOREST", "CLOUD", "OCEAN", "STORM", "EARTH", "LAKE", "SHORE", "SUN", "MOON", "STAR", "SKY", "RAIN", "SNOW", "WIND", "FOG", "ICE", "ROCK", "SAND", "CAVE", "DESERT", "VALLEY", "HILL", "MARSH", "SWAMP", "CREEK", "POND", "GLACIER", "VOLCANO", "ISLAND", "CANYON", "CLIFF", "CEMENT", "METAL", "STONE", "GRASS", "PLANT", "FLOWER", "GARDEN", "SHRUB", "TREES", "BRANCH", "LEAVES", "ROOT", "BARK", "SEED", "FRUIT", "FIELD", "MEADOW", "FARM", "HAY", "WHEAT", "GRASS", "THORN", "STREAM", "GULF", "BAY", "TUNDRA", "SAVANNA", "TEMPEST", "THUNDER", "LIGHT", "DUST", "SPACE", "VAPOR", "COAL", "OIL", "GAS", "HOUSE", "TABLE", "CHAIR", "DESK", "SOFA", "LAMP", "DOOR", "CLOCK", "SHELF", "BED", "PILLOW", "BLANKET", "TOWEL", "SOAP", "SHOWER", "TOILET", "SINK", "MIRROR", "OVEN", "STOVE", "FRIDGE", "RADIO", "PHONE", "WATCH", "KNIFE", "FORK", "SPOON", "PLATE", "BOWL", "GLASS", "CUP", "BOTTLE", "BOX", "CHEST", "TRUNK", "PAINT", "BRUSH", "PENCIL", "PAPER", "BOOK", "NOTE", "DIARY", "COIN", "MONEY", "PURSE", "WALLET", "GLOVE", "SHIRT", "JACKET", "SCARF", "SHOES", "BOOTS", "DRESS", "SKIRT", "BELT", "HAT", "COAT", "VEST", "SOCKS", "TIES", "HANGER", "CART", "WAGON", "MOTOR", "WHEEL", "AXLE", "TRAIN", "YACHT", "SHIP", "PLANE", "BIKE", "BICYCLE", "GEMINI", "SCRIPT", "MODEL", "CODE", "QUERY", "LEARN", "GREAT", "FLASH", "BRAIN", "SMART", "HAPPY", "FUNNY", "SILLY", "BRAVE", "SOBER", "QUIET", "LOUD", "QUICK", "SLOW", "BRIGHT", "DARK", "CALM", "WARM", "COLD", "SMALL", "LARGE", "TINY", "HUGE", "EMPTY", "FULL", "FIRST", "LAST", "BETTER", "WORSE", "READY", "SIMPLE", "COMPLEX", "TRUTH", "FAKE", "LOGIC", "MAGIC", "HUMAN", "ROBOT", "VIRUS", "DATA", "INPUT", "OUTPUT", "DEBUG", "CLICK", "PRINT", "DRIVE", "EMAIL", "CHAT", "VOICE", "IMAGE", "VIDEO", "SCREEN", "KEYPAD", "POWER", "CYCLE", "VALUE", "PRIME", "RATIO", "THEME", "STYLE", "FANCY", "PLAIN", "ROUGH", "SMOOTH", "SHARP", "DULL", "CLOSE", "OPEN", "START", "END", "BEGIN", "FINAL", "CHANCE", "ERROR", "GUARD", "PEACE", "WAR", "UNITY", "GROUP", "PARTY", "UNION", "FORCE", "SPEED", "VELOCITY", "ACCEL", "MASS", "VOLUME", "DENSITY", "FLUID", "SOLID", "GAS", "ENERGY", "FIELD", "WAVE", "PARTICLE", "ATOMIC", "SOLAR", "LUNAR", "GLOBAL", "LOCAL", "REMOTE", "OFFLINE", "ONLINE", "MOBILE", "FIBER", "SENSOR", "PROMPT", "TOKEN", "CACHE", "BUFFER", "ARRAY", "STACK", "QUEUE", "INDEX", "RANGE", "BOUNDS", "CONST", "PUBLIC", "PRIVATE", "ACCESS", "SYSTEM", "SERVER", "CLIENT", "ROUTER", "SWITCH", "CABLE", "WIRE", "SIGNAL", "AUDIO", "MUSIC", "DRAFT", "ESSAY", "REPORT", "GRADE", "CLASS", "STUDY", "TEACH", "WRITE", "READ", "MEMORY", "DREAM", "FUTURE", "PAST", "TODAY", "NIGHT", "MORNING", "AFTER", "BEFORE", "UNTIL", "WHILE", "JUMP", "RUN", "WALK", "WRITE", "THINK", "SPEAK", "POWER", "SLEEP", "FIGHT", "DANCE", "SING", "LISTEN", "TALK", "READ", "WATCH", "BUILD", "CREATE", "DRAW", "PAINT", "COOK", "EAT", "DRINK", "WASH", "CLEAN", "DRIVE", "RIDE", "FLY", "SWIM", "TEACH", "STUDY", "LEARN", "WORK", "START", "STOP", "OPEN", "CLOSE", "FIND", "SEARCH", "HIDE", "SHOW", "LOOK", "HEAR", "SMELL", "TASTE", "TOUCH", "PULL", "PUSH", "CARRY", "WEAR", "THROW", "CATCH", "CALL", "SEND", "MAIL", "TEXT", "WAIT", "HURRY", "QUICK", "SLOW", "ENTER", "EXIT", "CLIMB", "FALL", "RISE", "KICK", "GRASP", "REACH", "SOLVE", "PROVE", "CHECK", "SHARE", "VOTE", "AGREE", "RELOAD"];

        // --- ç´”ä¹Ÿã•ã‚“ã®åŸºæœ¬ãƒ­ã‚¸ãƒƒã‚¯ ---
        const maxIncorrectGuesses = 8;
        const humanParts = ["part-head", "part-body", "part-larm", "part-rarm", "part-lleg", "part-rleg"];
        const GAME_MODES = { ENDLESS: 'ã‚¨ãƒ³ãƒ‰ãƒ¬ã‚¹', STREAK_5: '5é€£å‹', STREAK_10: '10é€£å‹', TIME_ATTACK_5: '5é€£å‹ (TA)' };
        const keyboardLayout = ['QWERTYUIOP'.split(''), 'ASDFGHJKL'.split(''), 'ZXCVBNM'.split('')];

        let secretWord, guessedLetters, incorrectGuesses, gameStatus;
        let currentMode = localStorage.getItem('hangmanGameMode') || GAME_MODES.ENDLESS;
        let currentStreak = parseInt(localStorage.getItem('hangmanCurrentStreak') || '0', 10);
        let timerInterval, startTime, elapsedTime = parseFloat(localStorage.getItem('hangmanElapsedTime') || '0');

        const wordDisplay = document.getElementById('word-display');
        const keyboard = document.getElementById('keyboard');
        const guessedLettersList = document.getElementById('guessed-letters-list');
        const remainingGuessesSpan = document.getElementById('remaining-guesses');
        const restartButton = document.getElementById('restart-button');
        const messageModal = document.getElementById('message-modal');
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const modalCloseButton = document.getElementById('modal-close-button');
        const rulesModal = document.getElementById('rules-modal');
        const rulesBox = document.getElementById('rules-box');
        const rulesCloseButton = document.getElementById('rules-close-button');
        const modeSelectionButtons = document.getElementById('mode-selection-buttons');
        const currentModeDisplay = document.getElementById('current-mode-display');
        const currentStreakDisplay = document.getElementById('current-streak-display');
        const timerDisplay = document.getElementById('timer-display');
        const timerDisplayContainer = document.getElementById('timer-display-container');

        function initializeGame() {
            secretWord = words[Math.floor(Math.random() * words.length)];
            guessedLetters = new Set();
            incorrectGuesses = 0;
            gameStatus = 'playing';
            updateModeUI();
            updateWordDisplay();
            updateHangedMan();
            updateGuessedLettersList();
            updateRemainingGuesses();
            createKeyboard();
            restartButton.disabled = true;
            wordDisplay.classList.remove('text-red-500');
            stopTimer();
            if (currentMode === GAME_MODES.TIME_ATTACK_5) { startTimer(); timerDisplayContainer.classList.remove('hidden'); }
            else { timerDisplayContainer.classList.add('hidden'); }
        }

        function createModeSelectionButtons() {
            modeSelectionButtons.innerHTML = '';
            Object.values(GAME_MODES).forEach(mode => {
                const button = document.createElement('button');
                button.textContent = mode;
                button.classList.add('px-3', 'py-1', 'text-xs', 'font-semibold', 'rounded-full', 'transition', 'duration-150', 'border-2');
                if (mode === currentMode) { button.classList.add('bg-indigo-500', 'text-white', 'border-indigo-600'); }
                else { button.classList.add('bg-white', 'text-indigo-600', 'border-indigo-200', 'hover:bg-indigo-50'); }
                button.addEventListener('click', () => setGameMode(mode));
                modeSelectionButtons.appendChild(button);
            });
        }

        function setGameMode(mode) {
            currentMode = mode; localStorage.setItem('hangmanGameMode', mode);
            currentStreak = 0; elapsedTime = 0;
            localStorage.setItem('hangmanCurrentStreak', '0'); localStorage.setItem('hangmanElapsedTime', '0');
            updateModeUI(); initializeGame();
        }

        function updateModeUI() {
            currentModeDisplay.textContent = currentMode;
            currentStreakDisplay.textContent = currentStreak;
            timerDisplay.textContent = elapsedTime.toFixed(2);
            createModeSelectionButtons();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            startTime = Date.now() - (elapsedTime * 1000);
            timerInterval = setInterval(() => {
                elapsedTime = (Date.now() - startTime) / 1000;
                timerDisplay.textContent = elapsedTime.toFixed(2);
                localStorage.setItem('hangmanElapsedTime', elapsedTime.toFixed(2));
            }, 10);
        }
        function stopTimer() { if (timerInterval) clearInterval(timerInterval); timerInterval = null; }

        function updateWordDisplay() {
            wordDisplay.textContent = [...secretWord].map(l => guessedLetters.has(l) ? l : '_').join('');
        }

        function updateHangedMan() {
            document.getElementById("part-gallows-base").classList.toggle('hidden', incorrectGuesses < 1);
            const showGallows = incorrectGuesses >= 2;
            ["part-gallows-pole", "part-gallows-beam", "part-gallows-rope"].forEach(id => document.getElementById(id).classList.toggle('hidden', !showGallows));
            humanParts.forEach((id, i) => document.getElementById(id).classList.toggle('hidden', incorrectGuesses < (i + 3)));
        }

        function updateGuessedLettersList() { guessedLettersList.textContent = Array.from(guessedLetters).sort().join(', '); }
        function updateRemainingGuesses() { 
            remainingGuessesSpan.textContent = maxIncorrectGuesses - incorrectGuesses;
            remainingGuessesSpan.className = `font-bold ${maxIncorrectGuesses - incorrectGuesses <= 2 ? 'text-red-500' : 'text-green-500'}`;
        }

        function createKeyboard() {
            keyboard.innerHTML = '';
            keyboardLayout.forEach(row => {
                const rowDiv = document.createElement('div'); rowDiv.className = 'key-row';
                row.forEach(letter => {
                    const btn = document.createElement('button');
                    btn.textContent = letter; btn.className = 'key-button bg-indigo-500 text-white hover:bg-indigo-600 disabled:bg-gray-300 disabled:text-gray-500';
                    btn.setAttribute('data-letter', letter);
                    btn.addEventListener('click', () => handleGuess(letter, btn));
                    rowDiv.appendChild(btn);
                    if (guessedLetters.has(letter)) updateButtonState(letter, secretWord.includes(letter));
                });
                keyboard.appendChild(rowDiv);
            });
        }

        function updateButtonState(letter, isCorrect) {
            const btn = document.querySelector(`button[data-letter="${letter}"]`);
            if (btn) {
                btn.disabled = true; btn.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                btn.classList.add(isCorrect ? 'bg-green-500' : 'bg-red-500', 'text-white');
            }
        }

        function handleGuess(letter, btn) {
            if (gameStatus !== 'playing' || guessedLetters.has(letter)) return;
            guessedLetters.add(letter); updateGuessedLettersList();
            if (secretWord.includes(letter)) { updateWordDisplay(); updateButtonState(letter, true); }
            else { incorrectGuesses++; updateHangedMan(); updateRemainingGuesses(); updateButtonState(letter, false); }
            checkGameStatus();
        }

        function checkGameStatus() {
            const won = [...secretWord].every(l => guessedLetters.has(l));
            if (won) { gameStatus = 'won'; endGame(true); }
            else if (incorrectGuesses >= maxIncorrectGuesses) { gameStatus = 'lost'; endGame(false); }
        }

        function endGame(isWin) {
            stopTimer();
            Array.from(keyboard.querySelectorAll('button')).forEach(btn => btn.disabled = true);
            if (isWin) {
                currentStreak++; localStorage.setItem('hangmanCurrentStreak', currentStreak.toString()); updateModeUI();
                const target = (currentMode === GAME_MODES.STREAK_5 || currentMode === GAME_MODES.TIME_ATTACK_5) ? 5 : (currentMode === GAME_MODES.STREAK_10 ? 10 : Infinity);
                if (currentMode === GAME_MODES.ENDLESS || currentStreak >= target) {
                    let msg = currentMode === GAME_MODES.TIME_ATTACK_5 ? `ğŸ† TAå®Œäº†! ${elapsedTime.toFixed(2)}s` : `ğŸ‰ ${currentStreak}é€£å‹é”æˆ!`;
                    if(currentStreak >= target) { currentStreak = 0; elapsedTime = 0; localStorage.setItem('hangmanCurrentStreak', '0'); localStorage.setItem('hangmanElapsedTime', '0'); updateModeUI(); }
                    showMessage(msg, 'ãŠã‚ã§ã¨ã†ï¼'); restartButton.disabled = false;
                } else {
                    showMessage(`âœ… ${currentStreak}é€£å‹!`, 'æ¬¡ã¸ï¼', 1500);
                }
            } else {
                wordDisplay.textContent = secretWord; wordDisplay.classList.add('text-red-500');
                currentStreak = 0; elapsedTime = 0; localStorage.setItem('hangmanCurrentStreak', '0'); localStorage.setItem('hangmanElapsedTime', '0'); updateModeUI();
                showMessage('ğŸ’€ GAME OVER', `æ­£è§£ã¯ ${secretWord}`); restartButton.disabled = false;
            }
        }

        function showMessage(title, text, duration = 0) {
            messageTitle.textContent = title; messageText.textContent = text;
            messageModal.classList.remove('hidden'); messageModal.classList.add('flex', 'opacity-0');
            if (duration > 0) { modalCloseButton.classList.add('hidden'); setTimeout(() => { hideMessage(); initializeGame(); }, duration); }
            else { modalCloseButton.classList.remove('hidden'); modalCloseButton.onclick = hideMessage; }
            setTimeout(() => { messageModal.classList.remove('opacity-0'); messageBox.classList.remove('scale-95', 'opacity-0'); }, 10);
        }

        function hideMessage() {
            messageBox.classList.add('scale-95', 'opacity-0');
            setTimeout(() => { messageModal.classList.add('hidden'); messageModal.classList.remove('flex'); }, 300);
        }

        function showRulesModal() {
            rulesModal.classList.remove('hidden'); rulesModal.classList.add('flex', 'opacity-0');
            setTimeout(() => { rulesModal.classList.remove('opacity-0'); rulesBox.classList.remove('scale-95', 'opacity-0'); }, 10);
        }
        function hideRulesModal() {
            rulesBox.classList.add('scale-95', 'opacity-0');
            setTimeout(() => { rulesModal.classList.add('hidden'); rulesModal.classList.remove('flex'); }, 300);
        }

        // --- ã“ã“ã‹ã‚‰è¿½åŠ ï¼šARGæ¼”å‡ºãƒ­ã‚¸ãƒƒã‚¯ ---
        let inputBuffer = "";
        const SECRET_KEY = "READY"; 
        const FINAL_PASSWORD = "25E"; 

        document.addEventListener('keydown', (e) => {
            // ãƒ­ã‚°ã‚¤ãƒ³å…¥åŠ›ä¸­ã¯ãƒãƒ³ã‚°ãƒãƒ³ã®å…¥åŠ›ã‚’ç„¡è¦–
            if (document.activeElement.id === 'login-input') return;

            // ã‚³ãƒãƒ³ãƒ‰ç›£è¦–
            inputBuffer += e.key.toUpperCase();
            if (inputBuffer.endsWith(SECRET_KEY)) { triggerARG(); return; }
            if (inputBuffer.length > 20) inputBuffer = inputBuffer.substring(10);

            // --- æ—¢å­˜ã®ãƒãƒ³ã‚°ãƒãƒ³å‡¦ç† ---
            if (e.key === 'Enter') {
                if (!messageModal.classList.contains('hidden')) hideMessage();
                else if (!rulesModal.classList.contains('hidden')) hideRulesModal();
            }
            const key = e.key.toUpperCase();
            if (key.length === 1 && key >= 'A' && key <= 'Z' && gameStatus === 'playing') {
                const button = document.querySelector(`button[data-letter="${key}"]`);
                if (button && !button.disabled) handleGuess(key, button);
            }
        });

        function triggerARG() {
            document.getElementById('arg-curtain').classList.add('active');
            setTimeout(() => {
                document.getElementById('arg-screen').style.display = 'flex';
                runGlitch();
            }, 1500);
        }

        function runGlitch() {
            const area = document.getElementById('glitch-area');
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*";
            let count = 0;
            const timer = setInterval(() => {
                area.innerText = Array.from({length: 120}, () => chars[Math.floor(Math.random()*chars.length)]).join('');
                if (count++ > 30) {
                    clearInterval(timer);
                    area.innerHTML = ">> SYSTEM OVERRIDE SUCCESSFUL<br>>> INITIALIZING LOGIN PROTOCOL...";
                    setTimeout(() => {
                        document.getElementById('login-form').style.display = 'block';
                        document.getElementById('login-input').focus();
                    }, 1000);
                }
            }, 60);
        }

        document.getElementById('login-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (e.target.value.toUpperCase() === FINAL_PASSWORD) {
                    document.getElementById('success-content').classList.remove('hidden');
                } else {
                    document.getElementById('auth-status').innerText = "INVALID ACCESS KEY.";
                    e.target.value = "";
                }
            }
        });

        restartButton.addEventListener('click', initializeGame);
        rulesCloseButton.addEventListener('click', hideRulesModal);
        window.onload = () => { updateModeUI(); initializeGame(); if (!localStorage.getItem('hangmanHasVisited')) { showRulesModal(); localStorage.setItem('hangmanHasVisited', 'true'); } };
    </script>
</body>
</html>
